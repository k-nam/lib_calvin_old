(function(){var n,t,e;$(function(){return initialize_neko()}),this.initialize_neko=function(){return $(".sensei_balloon .script:hidden").each(function(){return show_senei()}),$(window).scroll(function(){return show_senei()})},this.show_senei=function(){return $(".sensei_balloon .script:hidden").each(function(){var n,i,s,o;t(this)&&(s=$(this),i=s.attr("name"),e[i]||(e[i]=!1),!0!==e[i]&&(n=s.closest(".balloon"),n.removeClass("hidden_neko").addClass("balloon-animation"),o=n.parent().parent().find(".sensei"),setTimeout(function(){o.show("slow").css("overflow","visible"),o.addClass("sensei-bounce").removeClass("hidden_neko")},500),setTimeout(function(){!0!==e[i]&&(e[i]=!0,show_script(s.attr("name")))},2e3)))})},this.reset_visible_state=function(){return Object.keys(e).forEach(function(n){return e[n]=!1})},t=function(n){var t,e,i;return!$(n).closest(".balloon").is(":hidden")&&(i=$(window).height(),e=$(window).scrollTop(),t=$(n).get(0).getBoundingClientRect().top,e>t-i+30)},e={},n={},this.init_script=function(t){var e;for($("#"+t+"_balloon .script").children().andSelf().contents().each(function(){3===this.nodeType&&$(this).replaceWith($(this).text().replace(/(\S)/g,"<span>$1</span>"))}),$("#"+t+"_balloon .script").append('<span class="cur">_</span>'),n[t]=setInterval(function(){$("#"+t+"_balloon .cur").toggle()},500),$("#"+t+"_balloon .script").css({opacity:1}),e=0;e<=$(".script").children().size()-1;)$("#"+t+"_balloon .script").children("span:eq("+e+")").not(".cur").delay(50*e).fadeIn(10),e++},this.show_script=function(t){if(""!==$("#"+t+"_script").text())return clearInterval(n[t]),$("#"+t+"_balloon").show(),$("#"+t+"_balloon .script").css({opacity:0}),$("#"+t+"_balloon .script").text($("#"+t+"_script").text()),init_script(t),gaq_push(["_trackEvent","Tutorial","show neko sensei script: "+t])}}).call(this);